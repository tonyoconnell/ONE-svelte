import{p as g}from"./parse.7d180a0f.js";import{c}from"./singletons.fa4d4adc.js";const h=c("invalidate_all"),k=c("before_navigate"),E=c("apply_action");function A(t){const o=JSON.parse(t);return o.data&&(o.data=g(o.data)),o}function w(t){return HTMLElement.prototype.cloneNode.call(t)}function D(t,o=()=>{}){const s=async({action:e,result:r,reset:n})=>{r.type==="success"&&(n!==!1&&HTMLFormElement.prototype.reset.call(t),await h()),(location.origin+location.pathname===e.origin+e.pathname||r.type==="redirect"||r.type==="error")&&E(r)};async function l(e){var d,b,f;e.preventDefault();const r=new URL((d=e.submitter)!=null&&d.hasAttribute("formaction")?e.submitter.formAction:w(t).action),n=new FormData(t),u=(b=e.submitter)==null?void 0:b.getAttribute("name");u&&n.append(u,((f=e.submitter)==null?void 0:f.getAttribute("value"))??"");const p=new AbortController;let m=!1;const y=await o({action:r,cancel:()=>m=!0,controller:p,get data(){return n},formData:n,get form(){return t},formElement:t,submitter:e.submitter})??s;if(m)return;let i;try{const a=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:n,signal:p.signal});i=A(await a.text()),i.type==="error"&&(i.status=a.status)}catch(a){if((a==null?void 0:a.name)==="AbortError")return;i={type:"error",error:a}}y({action:r,get data(){return n},formData:n,get form(){return t},formElement:t,update:a=>s({action:r,result:i,reset:a==null?void 0:a.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",l),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",l)}}}export{E as a,k as b,D as e,h as i};
